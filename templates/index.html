<!DOCTYPE html>
<html>
<head>
    <title>–î–µ—Ç–µ–∫—Ü–∏—è –≤–∞–≥–æ–Ω–æ–≤</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .upload { border: 2px dashed #007bff; padding: 40px; text-align: center; margin: 20px 0; cursor: pointer; }
        .images { display: flex; gap: 20px; margin: 20px 0; }
        .image-box { flex: 1; border: 1px solid #ddd; padding: 10px; }
        .image-box img { width: 100%; max-height: 400px; object-fit: contain; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; cursor: pointer; }
        .results { background: #f5f5f5; padding: 15px; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>–î–µ—Ç–µ–∫—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –≤–∞–≥–æ–Ω–æ–≤</h1>
    
    <div class="upload" onclick="document.getElementById('fileInput').click()">
        üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –≤–∞–≥–æ–Ω–∞
        <input type="file" id="fileInput" accept="image/*" style="display:none">
    </div>
    
    <div id="preview" style="display:none">
        <div class="images">
            <div class="image-box">
                <h3>–û—Ä–∏–≥–∏–Ω–∞–ª</h3>
                <img id="origImg">
            </div>
            <div class="image-box">
                <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
                <img id="resultImg">
            </div>
        </div>
        <button onclick="analyze()">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
    </div>
    
    <div id="loading" style="display:none">–û–±—Ä–∞–±–æ—Ç–∫–∞...</div>
    
    <div id="results" class="results" style="display:none">
        <h3>–ù–∞–π–¥–µ–Ω–æ –æ–±—ä–µ–∫—Ç–æ–≤: <span id="count">0</span></h3>
        <div id="predList"></div>
    </div>
    
    <script>
        let currentFile = null;
        
        document.getElementById('fileInput').onchange = function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            currentFile = file;
            const reader = new FileReader();
            
            reader.onload = function(e) {
                document.getElementById('origImg').src = e.target.result;
                document.getElementById('preview').style.display = 'block';
                document.getElementById('results').style.display = 'none';
            };
            
            reader.readAsDataURL(file);
        };
        
        async function analyze() {
            if (!currentFile) return;
            
            const btn = document.querySelector('button');
            btn.disabled = true;
            document.getElementById('loading').style.display = 'block';
            
            const formData = new FormData();
            formData.append('file', currentFile);
            
            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('resultImg').src = 'data:image/jpeg;base64,' + result.result_image;
                    document.getElementById('count').textContent = result.count;
                    
                    const predList = document.getElementById('predList');
                    predList.innerHTML = '';
                    
                    result.predictions.forEach(pred => {
                        const div = document.createElement('div');
                        div.innerHTML = `${pred.class_name} - ${(pred.confidence*100).toFixed(1)}%`;
                        predList.appendChild(div);
                    });
                    
                    document.getElementById('results').style.display = 'block';
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + result.error);
                }
            } catch (err) {
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + err.message);
            } finally {
                btn.disabled = false;
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        // Drag and drop
        const dropArea = document.querySelector('.upload');
        dropArea.addEventListener('drop', e => {
            e.preventDefault();
            const file = e.dataTransfer.files[0];
            if (file) {
                document.getElementById('fileInput').files = e.dataTransfer.files;
                document.getElementById('fileInput').dispatchEvent(new Event('change'));
            }
        });
        dropArea.addEventListener('dragover', e => e.preventDefault());
    </script>
</body>
</html>